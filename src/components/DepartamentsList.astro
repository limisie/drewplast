---
import {
  getLocalizedCollectionData,
  getLocalizedDataByEntries,
} from "@lib/data";
import { defaultLocale } from "@i18n/ui";

import ContactList from "@components/ContactList.astro";

const locale = Astro.currentLocale || defaultLocale;

const departaments = await getLocalizedCollectionData("departaments", locale);
const employeesLists = await Promise.all(
  departaments.map(
    async (departament) =>
      await getLocalizedDataByEntries(departament.employeesList, locale)
  )
);
---

<ul>
  {
    departaments.map((departament, i) => (
      <li class="underlined-element">
        <span class="h3">{departament.title}</span>
        <ContactList dataList={employeesLists[i]} />
      </li>
    ))
  }
</ul>

<style>
  ul {
    display: flex;
    flex-direction: column;
  }

  li {
    padding-block: var(--spacer-responsive);

    display: flex;
    flex-direction: column;

    > ul {
      flex-basis: 100%;
    }

    > span {
      min-width: 20vw;
      margin-bottom: var(--spacer);
    }
  }

  li:last-child {
    padding-bottom: 0;

    &::after {
      display: none;
    }
  }

  @media (min-width: 48rem) {
    li {
      flex-direction: row;
      gap: var(--spacer-responsive);

      > ul {
        flex-basis: 100%;
      }
    }
  }
</style>
