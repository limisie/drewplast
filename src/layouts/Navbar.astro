---
import { Icon } from "astro-icon/components";
import { getLocalizedDataByEntry, getLocalizedLinks } from "@lib/data";
import { defaultLocale } from "@i18n/ui";
import { getLocaleUrl, getLocalizedUrlList } from "@i18n/urls";
import type { PageLink } from "@lib/types";

import LanguagePicker from "@components/LanguagePicker.astro";

const locale = Astro.currentLocale || defaultLocale;
const links = await getLocalizedLinks("navbar", locale);

const homepageData = (await getLocalizedDataByEntry(
  { collection: "pages", id: "strona-glowna" },
  locale
)) as PageLink;

const homePaths = Object.values(getLocalizedUrlList(defaultLocale, "/"));
const isHomePage = homePaths.includes(Astro.url.pathname);
---

<nav class=`content-grid ${isHomePage && "homepage"}`>
  <div class="flex">
    <a class="logo" href={getLocaleUrl(locale, homepageData.seo.slug)}>
      <Icon name="logo" />
      <Icon name="logo-text" />
    </a>

    <ul id="nav-links">
      {
        links.map(({ url, text }) => (
          <li>
            <a href={getLocaleUrl(locale, url)} class="navlink">
              {text}
            </a>
          </li>
        ))
      }
      <li>
        <LanguagePicker />
      </li>
    </ul>
  </div>
</nav>

<style>
  nav {
    position: fixed;
    z-index: 999;
    left: 0;
    right: 0;
    padding-block: var(--spacer);

    background-color: var(--clr-background);
    color: var(--clr-text);

    transition:
      background-color 0.2s ease-in,
      color 0.5s ease-in;

    &::before {
      content: "";
      position: absolute;
      top: var(--section-padding);
      left: 0;
      right: 0;
      height: 1px;
      background-color: var(--clr-border);
    }

    &.homepage {
      background-color: transparent;
      color: var(--white);
    }
  }

  ul {
    display: flex;
    align-items: center;
    gap: var(--spacer-responsive);
  }

  .logo {
    display: flex;
    font-size: calc(var(--section-padding) - 2.5 * var(--spacer));
    gap: var(--spacer);
  }

  [data-icon="logo-text"] {
    margin-top: 0.5rem;
  }

  [data-icon="logo"] {
    color: var(--blue);

    &:active {
      color: var(--dark-blue);
    }
  }
</style>

<script>
  const homeNav = document.querySelector(".homepage");

  homeNav &&
    window.addEventListener("scroll", () => {
      homeNav.classList.toggle("homepage", window.scrollY < 5);
    });
</script>
