---
import {
  getFilteredReferences,
  filterDistributorsByRegion,
  getLocalizedDataWithId,
} from "@lib/data";
import { defaultLocale } from "@i18n/ui";

import TabLogic from "@components/TabLogic.astro";

const locale = Astro.currentLocale || defaultLocale;

const regions = await getLocalizedDataWithId("regions", locale);

const distributorsByRegion = await Promise.all(
  regions.map(async (region) =>
    (
      await getFilteredReferences(
        "distributors",
        filterDistributorsByRegion,
        region.id
      )
    ).map(({ data }) => data)
  )
);
---

<TabLogic
  tabList={regions.map((region) => region.title)}
  contentList={distributorsByRegion}
  mode="distributors"
/>
